{% extends "base.html" %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'home/assets_shop/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'home/assets_shop/css/colors/color-1.css' %}">
    <script src="https://js.stripe.com/v3/"></script>

<style>
        /* Alternative: "Card" Look */
        #checkout {
            background: #ffffff;
            padding: 5rem;
            border-radius: 4rem;
            box-shadow: 0 4px 50px rgba(0,0,0,0.05); /* Soft shadow */
        }
    </style>

{% endblock %}

{% block content %}
<main class="main">
    <section class="section container">
        <h2 class="section__title">Secure Checkout</h2>
        
        <div id="checkout" style="min-height: 400px; max-width: 800px; margin: 0 auto;">
            <div style="text-align: center; padding: 4rem;">
                <i class="bx bx-loader-alt bx-spin" style="font-size: 2rem; color: #575757;"></i>
                <p>Loading checkout...</p>
            </div>
        </div>
        <div id="error-message" style="color: red; text-align: center; display: none;"></div>
    </section>
</main>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    const stripeKey = "{{ STRIPE_PUBLISHABLE_KEY }}";
    const clientSecret = "{{ client_secret }}";

    if (stripeKey && clientSecret) {
        const stripe = Stripe(stripeKey);
        (async () => {
            try {
                const checkout = await stripe.initEmbeddedCheckout({ 
                    clientSecret: clientSecret
                    // REMOVED: appearance parameter causing error
                });
                document.getElementById('checkout').innerHTML = ''; 
                checkout.mount('#checkout');
            } catch (e) {
                document.getElementById('error-message').innerText = e.message;
                document.getElementById('error-message').style.display = 'block';
            }
        })();
    }
</script>
{% endblock %}